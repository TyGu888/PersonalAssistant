# LLM 配置 - 支持多 Provider Profile
llm_profiles:
  # 火山引擎方舟 (Doubao)
  ark_doubao:
    api_key: ${ARK_API_KEY}
    base_url: https://ark.cn-beijing.volces.com/api/v3
    model: ep-20260128095801-jc4gx
    extra_params:
      reasoning_effort: medium  # minimal|low|medium|high
  
  # DeepSeek Chat (普通对话)
  deepseek_chat:
    api_key: ${DEEPSEEK_API_KEY}
    base_url: https://api.deepseek.com
    model: deepseek-chat
  
  # DeepSeek Reasoner (R1 推理)
  deepseek_reasoner:
    api_key: ${DEEPSEEK_API_KEY}
    base_url: https://api.deepseek.com
    model: deepseek-reasoner
    features:
      preserve_reasoning_content: true  # 多轮对话保留 reasoning_content
  
  # OpenAI
  openai_gpt4o:
    api_key: ${OPENAI_API_KEY}
    base_url: https://api.openai.com/v1
    model: gpt-4o

# 当前使用的 LLM Profile
llm:
  active: deepseek_reasoner  # 切换这里即可换模型
  max_context_tokens: 16000
  max_response_tokens: 8192

# Gateway 配置 (新架构)
gateway:
  enabled: true
  host: "0.0.0.0"
  port: 8080
  # api_key: ${HTTP_API_KEY}  # 取消注释启用 API Key 认证

# Agent 配置 (新架构)
agent:
  wake_interval: 0         # 周期性唤醒间隔（秒），0 = 仅事件驱动

# 数据目录（SQLite + ChromaDB）
data:
  dir: ./data  # 会创建 sessions.db 和 chroma/

# Skills 配置
skills:
  dir: ./skills  # Skills 目录路径
  # 可选：覆盖特定 skill 的配置
  overrides:
    study_coach:
      enabled: true
    default:
      enabled: true
    coding_assistant:
      enabled: true
    project_manager:
      enabled: true

# Memory 配置
memory:
  identity_mode: "single_owner"  # "single_owner" | "multi_user"
  max_context_messages: 10  # 上下文最大消息数（向后兼容，按条数截断）
  max_context_tokens: 16000  # 新增：按 token 截断（优先于条数截断）

# Channel 配置
channels:
  cli:
    enabled: false   
  telegram:
    enabled: false  # Phase 0 先关闭
    token: ${TELEGRAM_BOT_TOKEN}
    allowed_users: ["968804902337912883"]  # 白名单
  discord:
    enabled: true
    token: ${DISCORD_BOT_TOKEN}
    allowed_users: ["968804902337912883"]  # 白名单
  http:
    enabled: false  # HTTP 已迁移到 gateway
    host: "0.0.0.0"
    port: 8080
    api_key: ${HTTP_API_KEY}  # 可选：API Key 认证，为空则不验证

# Channel 专用工具配置
# 当消息来自某个 channel 时，自动将这些工具添加到可用工具列表
# 注意：这些工具需要单独实现，这里只是建立机制
channel_tools:
  discord: [discord_send_message, discord_reply_message, discord_add_reaction, discord_create_thread]
  telegram: [telegram_send_message]

# 路由规则
# 现在只有一个 default agent，所有消息都给全部工具
# Agent 可以通过 read_file 读取 skills/ 目录下的 SKILL.md 获取专业指导
routing:
  - match: {}  # 所有消息
    agent: default
    tools: [
      # 文件操作
      create_file, read_file, list_files, append_file, delete_file, send_file, 
      edit_file, find_files, grep_files, write_file,
      # 网络
      web_search, fetch_url,
      # 定时提醒
      scheduler_add, scheduler_list, scheduler_cancel,
      # Shell / 沙箱
      run_command, sandbox_start, sandbox_exec, sandbox_stop, sandbox_copy_to, sandbox_copy_from, sandbox_status,
      # 记忆
      memory_search, memory_add,
      # Sub-Agent
      agent_spawn, agent_list, agent_send, agent_history,
      # Channel (主动发消息)
      send_message
    ]

# Docker 沙箱配置
sandbox:
  enabled: false  # 默认关闭，启用后 shell 命令将在容器中执行
  image: "personalassistant-sandbox:latest"  # 沙箱镜像
  memory_limit: "512m"  # 内存限制
  cpu_limit: 1.0  # CPU 限制（核数）
  network: "none"  # 网络模式: "none"(无网络) 或 "bridge"(桥接)
  workspace_mount: "./data/workspace"  # 工作目录挂载路径

# MCP (Model Context Protocol) 配置
# 连接外部 MCP Server 复用社区工具
mcp:
  enabled: false  # 默认关闭，启用后加载 MCP Servers
  servers:
    # 示例: 文件系统 Server
    # - name: filesystem
    #   command: npx
    #   args: ["-y", "@modelcontextprotocol/server-filesystem", "./data/workspace"]
    
    # 示例: GitHub Server
    # - name: github
    #   command: npx
    #   args: ["-y", "@modelcontextprotocol/server-github"]
    #   env:
    #     GITHUB_PERSONAL_ACCESS_TOKEN: ${GITHUB_TOKEN}
    
    # 示例: Brave Search Server
    # - name: brave-search
    #   command: npx
    #   args: ["-y", "@modelcontextprotocol/server-brave-search"]
    #   env:
    #     BRAVE_API_KEY: ${BRAVE_API_KEY}

# Agent 定义
agents:
  study_coach:
    prompt: |
      你是一个严厉但关心学生的学习教练。
      督促用户学习，提醒完成任务。
      
      ## 处理定时任务触发
      当收到 [定时任务触发] 开头的消息时：
      1. 友好地提醒用户
      2. 设置下一次提醒（scheduler_add，auto_continue=True）
      3. 可选：设置1小时后的追问提醒（auto_continue=False）
  
  default:
    prompt: |
      你是一个友好的助手。
      
      ## 处理定时任务触发
      当收到 [定时任务触发] 开头的消息时：
      1. 友好地提醒用户该做的事
      2. 设置下一次提醒（scheduler_add，auto_continue=True，默认明天同一时间）
      3. 可选：设置1小时后的追问提醒（auto_continue=False）
